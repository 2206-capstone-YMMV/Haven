{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{useEffect,useState}from\"react\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import View from\"react-native-web/dist/exports/View\";import KeyboardAvoidingView from\"react-native-web/dist/exports/KeyboardAvoidingView\";import TextInput from\"react-native-web/dist/exports/TextInput\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import{auth}from\"../firebase\";import{db}from\"../firebase\";import{collection,onSnapshot,query,where,addDoc,getDocs}from\"firebase/firestore\";import{LinearGradient}from'expo-linear-gradient';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Message(_ref){var route=_ref.route;var conversationId=route.params.conversationId;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),conversation=_useState2[0],setConversation=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),displayName=_useState6[0],setDisplayName=_useState6[1];useEffect(function(){return onSnapshot(query(collection(db,\"Messages\"),where(\"conversationId\",\"==\",conversationId)),function(snapshot){return setConversation(snapshot.docs.map(function(convo){console.log(\"Grabbing Messages\");return convo.data();}).sort(function(a,b){return a.timestamp-b.timestamp;}));});},[]);if(!displayName){var _auth$currentUser;getDocs(query(collection(db,\"users\"),where(\"uid\",\"==\",(_auth$currentUser=auth.currentUser)==null?void 0:_auth$currentUser.uid))).then(function(user){console.log(\"Grabbing Username\"),setDisplayName(user.docs[0].data());});}var handleSend=function handleSend(){addDoc(collection(db,\"Messages\"),{conversationId:conversationId,timestamp:Date.now(),messenger:displayName,content:message}).then(function(){setMessage(\"\");}).catch(function(error){return alert(error.message);});};return _jsx(KeyboardAvoidingView,{behavior:\"padding\",style:{flex:1,alignItems:\"center\",justifyContent:\"space-between\"},keyboardVerticalOffset:100,children:_jsx(LinearGradient,{colors:[\"#8c5aa5\",\"#f2e797\"],style:{width:\"100%\",height:\"100%\"},children:_jsxs(ScrollView,{children:[_jsx(View,{style:styles.messageContainer,children:conversation.map(function(convo,index){if(convo.messenger.uid!==auth.currentUser.uid){return _jsx(Text,{style:styles.message,children:convo.messenger.name+': '+convo.content},index);}else{return _jsx(Text,{style:[styles.message,styles.user],children:'You: '+convo.content},index);}})}),_jsxs(View,{style:styles.inputContainer,children:[_jsx(TextInput,{placeholder:\"Message\",value:message,onChangeText:function onChangeText(text){return setMessage(text);},style:styles.input,multiline:true,blurOnSubmit:true}),_jsx(TouchableOpacity,{onPress:handleSend,style:styles.button,children:_jsx(Text,{style:styles.buttonText,children:\"Send\"})})]})]})})});}var styles=StyleSheet.create({messageContainer:{alignSelf:\"flex-start\",alignItems:\"left\",paddingHorizontal:\"10%\",width:'100%'},message:{backgroundColor:\"white\",paddingVertical:5,paddingHorizontal:5,marginTop:5,borderRadius:10,overflow:'hidden'},user:{alignSelf:'flex-end'},inputContainer:{alignSelf:\"center\",width:\"80%\",backgroundColor:\"white\",paddingHorizontal:15,paddingVertical:10,borderRadius:10,flexDirection:\"row\",marginTop:10,marginBottom:10},input:{width:\"80%\"},buttonContainer:{width:\"20%\"},button:{padding:5,backgroundColor:\"#0782F9\",borderRadius:10,alignItems:\"center\"},buttonText:{color:\"white\",fontWeight:\"700\",fontSize:16}});","map":{"version":3,"names":["React","useEffect","useState","auth","db","collection","onSnapshot","query","where","addDoc","getDocs","LinearGradient","Message","route","conversationId","params","conversation","setConversation","message","setMessage","displayName","setDisplayName","snapshot","docs","map","convo","console","log","data","sort","a","b","timestamp","currentUser","uid","then","user","handleSend","Date","now","messenger","content","catch","error","alert","flex","alignItems","justifyContent","width","height","styles","messageContainer","index","name","inputContainer","text","input","button","buttonText","StyleSheet","create","alignSelf","paddingHorizontal","backgroundColor","paddingVertical","marginTop","borderRadius","overflow","flexDirection","marginBottom","buttonContainer","padding","color","fontWeight","fontSize"],"sources":["C:/Users/16476/Documents/GitHub/Haven/screens/Message.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport {\r\n  StyleSheet,\r\n  Text,\r\n  View,\r\n  KeyboardAvoidingView,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  ScrollView,\r\n} from \"react-native\";\r\nimport { auth } from \"../firebase\";\r\nimport { db } from \"../firebase\";\r\nimport {\r\n  collection,\r\n  onSnapshot,\r\n  query,\r\n  where,\r\n  addDoc,\r\n  getDocs,\r\n} from \"firebase/firestore\";\r\nimport { LinearGradient } from 'expo-linear-gradient';\r\n\r\nexport default function Message({ route }) {\r\n  const { conversationId } = route.params;\r\n  const [conversation, setConversation] = useState([]);\r\n  const [message, setMessage] = useState(\"\");\r\n  const [displayName, setDisplayName] = useState(\"\");\r\n\r\n  useEffect(\r\n    () =>\r\n      onSnapshot(\r\n        query(\r\n          collection(db, \"Messages\"),\r\n          where(\"conversationId\", \"==\", conversationId)\r\n        ),\r\n        (snapshot) =>\r\n          setConversation(\r\n            snapshot.docs\r\n              .map((convo) => {\r\n                console.log(\"Grabbing Messages\");\r\n                return convo.data();\r\n              })\r\n              .sort((a, b) => a.timestamp - b.timestamp)\r\n          )\r\n      ),\r\n    []\r\n  );\r\n\r\n  if (!displayName) {\r\n    getDocs(\r\n      query(collection(db, \"users\"), where(\"uid\", \"==\", auth.currentUser?.uid))\r\n    ).then((user) => {\r\n      console.log(\"Grabbing Username\"),\r\n        setDisplayName(user.docs[0].data());\r\n    });\r\n  }\r\n\r\n  const handleSend = () => {\r\n    addDoc(collection(db, \"Messages\"), {\r\n      conversationId,\r\n      timestamp: Date.now(),\r\n      messenger: displayName,\r\n      content: message,\r\n    })\r\n      .then(() => {\r\n        setMessage(\"\");\r\n      })\r\n      .catch((error) => alert(error.message));\r\n  };\r\n\r\n  return (\r\n    \r\n    <KeyboardAvoidingView behavior=\"padding\"\r\n      style={{ flex: 1, alignItems: \"center\", justifyContent: \"space-between\"}}\r\n      keyboardVerticalOffset={100}\r\n    >\r\n    <LinearGradient colors={[\"#8c5aa5\", \"#f2e797\"]} style={{width: \"100%\", height: \"100%\"}}>\r\n    <ScrollView>\r\n      <View style={styles.messageContainer}>\r\n        {conversation.map((convo, index) => {\r\n          if(convo.messenger.uid !== auth.currentUser.uid){\r\n            return (<Text key={index} style={styles.message}>\r\n              {convo.messenger.name + ': ' + convo.content}\r\n            </Text>)\r\n          }\r\n          else{\r\n            return (<Text key={index} style={[styles.message, styles.user]}>\r\n              {'You: ' + convo.content}\r\n            </Text>)\r\n          }\r\n          })}\r\n      </View>\r\n      <View style={styles.inputContainer}>\r\n        <TextInput\r\n          placeholder=\"Message\"\r\n          value={message}\r\n          onChangeText={(text) => setMessage(text)}\r\n          style={styles.input}\r\n          multiline={true}\r\n          blurOnSubmit={true}\r\n        ></TextInput>\r\n        <TouchableOpacity onPress={handleSend} style={styles.button}>\r\n          <Text style={styles.buttonText}>Send</Text>\r\n        </TouchableOpacity>\r\n        \r\n      </View>\r\n      </ScrollView>\r\n      </LinearGradient>\r\n    </KeyboardAvoidingView>\r\n    \r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  messageContainer: {\r\n    alignSelf: \"flex-start\",\r\n    alignItems: \"left\",\r\n    paddingHorizontal: \"10%\",\r\n    width: '100%'\r\n  },\r\n  message: {\r\n    backgroundColor: \"white\",\r\n    paddingVertical: 5,\r\n    paddingHorizontal: 5,\r\n    marginTop: 5,\r\n    borderRadius: 10,\r\n    overflow: 'hidden'\r\n  },\r\n  user: {\r\n    alignSelf: 'flex-end'\r\n  },\r\n  inputContainer: {\r\n    alignSelf: \"center\",\r\n    width: \"80%\",\r\n    backgroundColor: \"white\",\r\n    paddingHorizontal: 15,\r\n    paddingVertical: 10,\r\n    borderRadius: 10,\r\n    flexDirection: \"row\",\r\n    marginTop: 10,\r\n    marginBottom: 10\r\n  },\r\n  input: {\r\n    width: \"80%\"\r\n  },\r\n  buttonContainer: {\r\n    width: \"20%\",\r\n  },\r\n  button: {\r\n    padding: 5,\r\n    backgroundColor: \"#0782F9\",\r\n    borderRadius: 10,\r\n    alignItems: \"center\",\r\n  },\r\n  buttonText: {\r\n    color: \"white\",\r\n    fontWeight: \"700\",\r\n    fontSize: 16,\r\n  },\r\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}