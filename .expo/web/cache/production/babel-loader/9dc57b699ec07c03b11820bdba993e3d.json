{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{useEffect,useState}from\"react\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import View from\"react-native-web/dist/exports/View\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import{auth}from\"../firebase\";import{db}from\"../firebase\";import{collection,onSnapshot,query,where,getDocs}from\"firebase/firestore\";import{LinearGradient}from\"expo-linear-gradient\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function MessagesTab(_ref){var navigation=_ref.navigation;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),conversations=_useState2[0],setConversations=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),otherUsers=_useState4[0],setOtherUsers=_useState4[1];useEffect(function(){var _auth$currentUser;return onSnapshot(query(collection(db,\"Conversations\"),where(\"user\",\"==\",(_auth$currentUser=auth.currentUser)==null?void 0:_auth$currentUser.uid)),function(snapshot){return setConversations(snapshot.docs.map(function(convo){return convo.data();}));});},[]);var conversationIds=conversations.map(function(convo){return convo.conversationId;});var otherUsersId=conversations.map(function(convo){return convo.otherUser;});if(otherUsersId.length===0){otherUsersId.push(\"aaaaaaaaaaa\");}if(conversations.length>0&&otherUsers.length===0||conversations.length>otherUsers.length){getDocs(query(collection(db,\"users\"),where(\"uid\",\"in\",otherUsersId))).then(function(users){return setOtherUsers(users.docs.map(function(user){return user.data();}));});}var names=otherUsersId.map(function(id){for(var i=0;i<otherUsers.length;i++){if(otherUsers[i].uid===id){return otherUsers[i].name;}}});return _jsxs(LinearGradient,{colors:[\"#8c5aa5\",\"#f2e797\"],style:{flex:1,alignItems:\"center\",justifyContent:\"space-between\"},children:[_jsx(Text,{style:[styles.convo,styles.new],onPress:function onPress(){return navigation.navigate(\"NewConversation\",{conversations:conversations});},children:\"New Conversation\"}),_jsx(ScrollView,{children:conversationIds.map(function(conversationId,index){return _jsxs(Text,{style:styles.convo,onPress:function onPress(){return navigation.navigate(\"Message\",{conversationId:conversationId});},children:[\"Conversation with \",names[index]]},index);})})]});}var styles=StyleSheet.create({new:{marginBottom:\"10%\",fontSize:30},convo:{backgroundColor:\"white\",paddingVertical:5,paddingHorizontal:5,marginTop:5,borderRadius:10,overflow:\"hidden\",textAlign:\"center\",fontSize:18}});","map":{"version":3,"names":["React","useEffect","useState","auth","db","collection","onSnapshot","query","where","getDocs","LinearGradient","MessagesTab","navigation","conversations","setConversations","otherUsers","setOtherUsers","currentUser","uid","snapshot","docs","map","convo","data","conversationIds","conversationId","otherUsersId","otherUser","length","push","then","users","user","names","id","i","name","flex","alignItems","justifyContent","styles","new","navigate","index","StyleSheet","create","marginBottom","fontSize","backgroundColor","paddingVertical","paddingHorizontal","marginTop","borderRadius","overflow","textAlign"],"sources":["C:/Users/16476/Documents/GitHub/Haven/screens/MessagesTab.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { StyleSheet, Text, View, ScrollView } from \"react-native\";\r\nimport { auth } from \"../firebase\";\r\nimport { db } from \"../firebase\";\r\nimport {\r\n  collection,\r\n  onSnapshot,\r\n  query,\r\n  where,\r\n  getDocs,\r\n} from \"firebase/firestore\";\r\nimport { LinearGradient } from \"expo-linear-gradient\";\r\n\r\nexport default function MessagesTab({ navigation }) {\r\n  const [conversations, setConversations] = useState([]);\r\n  const [otherUsers, setOtherUsers] = useState([]);\r\n\r\n  useEffect(\r\n    () =>\r\n      onSnapshot(\r\n        query(\r\n          collection(db, \"Conversations\"),\r\n          where(\"user\", \"==\", auth.currentUser?.uid)\r\n        ),\r\n        (snapshot) =>\r\n          setConversations(\r\n            snapshot.docs.map((convo) => {\r\n              return convo.data();\r\n            })\r\n          )\r\n      ),\r\n    []\r\n  );\r\n\r\n  const conversationIds = conversations.map((convo) => convo.conversationId);\r\n  const otherUsersId = conversations.map((convo) => convo.otherUser);\r\n\r\n  if (otherUsersId.length === 0) {\r\n    otherUsersId.push(\"aaaaaaaaaaa\");\r\n  }\r\n\r\n  if (\r\n    (conversations.length > 0 && otherUsers.length === 0) ||\r\n    conversations.length > otherUsers.length\r\n  ) {\r\n    //After the conversations have been grabbed, but dont want this to repeat when page rerenders\r\n    getDocs(\r\n      query(collection(db, \"users\"), where(\"uid\", \"in\", otherUsersId))\r\n    ).then((users) =>\r\n      setOtherUsers(\r\n        users.docs.map((user) => {\r\n          return user.data();\r\n        })\r\n      )\r\n    );\r\n  }\r\n\r\n  const names = otherUsersId.map((id) => {\r\n    //lining up names with the order of the conversationIds\r\n    for (let i = 0; i < otherUsers.length; i++) {\r\n      if (otherUsers[i].uid === id) {\r\n        return otherUsers[i].name;\r\n      }\r\n    }\r\n  });\r\n\r\n  // console.log(names)\r\n\r\n  return (\r\n    <LinearGradient\r\n      colors={[\"#8c5aa5\", \"#f2e797\"]}\r\n      style={{ flex: 1, alignItems: \"center\", justifyContent: \"space-between\" }}\r\n    >\r\n      <Text\r\n        style={[styles.convo, styles.new]}\r\n        onPress={() =>\r\n          navigation.navigate(\"NewConversation\", { conversations })\r\n        }\r\n      >\r\n        New Conversation\r\n      </Text>\r\n      <ScrollView>\r\n        {conversationIds.map((conversationId, index) => (\r\n          <Text\r\n            key={index}\r\n            style={styles.convo}\r\n            onPress={() => navigation.navigate(\"Message\", { conversationId })}\r\n          >\r\n            Conversation with {names[index]}\r\n          </Text>\r\n        ))}\r\n      </ScrollView>\r\n    </LinearGradient>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  new: {\r\n    marginBottom: \"10%\",\r\n    fontSize: 30,\r\n  },\r\n  convo: {\r\n    backgroundColor: \"white\",\r\n    paddingVertical: 5,\r\n    paddingHorizontal: 5,\r\n    marginTop: 5,\r\n    borderRadius: 10,\r\n    overflow: \"hidden\",\r\n    textAlign: \"center\",\r\n    fontSize: 18,\r\n  },\r\n});\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}