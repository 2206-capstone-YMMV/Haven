{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _createClass from\"@babel/runtime/helpers/createClass\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _wrapNativeSuper from\"@babel/runtime/helpers/wrapNativeSuper\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}import{PermissionStatus}from'expo-modules-core';import{LocationAccuracy}from\"./Location.types\";import{LocationEventEmitter}from\"./LocationEventEmitter\";var GeocoderError=function(_Error){_inherits(GeocoderError,_Error);var _super=_createSuper(GeocoderError);function GeocoderError(){var _this;_classCallCheck(this,GeocoderError);_this=_super.call(this,'Geocoder service is not available for this device.');_this.code='E_NO_GEOCODER';return _this;}return _createClass(GeocoderError);}(_wrapNativeSuper(Error));function geolocationPositionToJSON(position){var coords=position.coords,timestamp=position.timestamp;return{coords:{latitude:coords.latitude,longitude:coords.longitude,altitude:coords.altitude,accuracy:coords.accuracy,altitudeAccuracy:coords.altitudeAccuracy,heading:coords.heading,speed:coords.speed},timestamp:timestamp};}function isLocationValid(location,options){var _location$coords$accu;var maxAge=typeof options.maxAge==='number'?options.maxAge:Infinity;var requiredAccuracy=typeof options.requiredAccuracy==='number'?options.requiredAccuracy:Infinity;var locationAccuracy=(_location$coords$accu=location.coords.accuracy)!=null?_location$coords$accu:Infinity;return Date.now()-location.timestamp<=maxAge&&locationAccuracy<=requiredAccuracy;}function getPermissionsAsync(){return _getPermissionsAsync.apply(this,arguments);}function _getPermissionsAsync(){_getPermissionsAsync=_asyncToGenerator(function*(){return new Promise(function(resolve){var resolveWithStatus=function resolveWithStatus(status){return resolve({status:status,granted:status===PermissionStatus.GRANTED,canAskAgain:true,expires:0});};navigator.geolocation.getCurrentPosition(function(){return resolveWithStatus(PermissionStatus.GRANTED);},function(_ref){var code=_ref.code;if(code===1){resolveWithStatus(PermissionStatus.DENIED);}else{resolveWithStatus(PermissionStatus.UNDETERMINED);}},{enableHighAccuracy:false,maximumAge:Infinity});});});return _getPermissionsAsync.apply(this,arguments);}var lastKnownPosition=null;export default{get name(){return'ExpoLocation';},getProviderStatusAsync:function(){var _getProviderStatusAsync=_asyncToGenerator(function*(){return{locationServicesEnabled:'geolocation'in navigator};});function getProviderStatusAsync(){return _getProviderStatusAsync.apply(this,arguments);}return getProviderStatusAsync;}(),getLastKnownPositionAsync:function(){var _getLastKnownPositionAsync=_asyncToGenerator(function*(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(lastKnownPosition&&isLocationValid(lastKnownPosition,options)){return lastKnownPosition;}return null;});function getLastKnownPositionAsync(){return _getLastKnownPositionAsync.apply(this,arguments);}return getLastKnownPositionAsync;}(),getCurrentPositionAsync:function(){var _getCurrentPositionAsync=_asyncToGenerator(function*(options){return new Promise(function(resolve,reject){var _options$accuracy;var resolver=function resolver(position){lastKnownPosition=geolocationPositionToJSON(position);resolve(lastKnownPosition);};navigator.geolocation.getCurrentPosition(resolver,reject,_objectSpread({maximumAge:Infinity,enableHighAccuracy:((_options$accuracy=options.accuracy)!=null?_options$accuracy:0)>LocationAccuracy.Balanced},options));});});function getCurrentPositionAsync(_x){return _getCurrentPositionAsync.apply(this,arguments);}return getCurrentPositionAsync;}(),removeWatchAsync:function(){var _removeWatchAsync=_asyncToGenerator(function*(watchId){navigator.geolocation.clearWatch(watchId);});function removeWatchAsync(_x2){return _removeWatchAsync.apply(this,arguments);}return removeWatchAsync;}(),watchDeviceHeading:function(){var _watchDeviceHeading=_asyncToGenerator(function*(headingId){console.warn('Location.watchDeviceHeading: is not supported on web');});function watchDeviceHeading(_x3){return _watchDeviceHeading.apply(this,arguments);}return watchDeviceHeading;}(),hasServicesEnabledAsync:function(){var _hasServicesEnabledAsync=_asyncToGenerator(function*(){return'geolocation'in navigator;});function hasServicesEnabledAsync(){return _hasServicesEnabledAsync.apply(this,arguments);}return hasServicesEnabledAsync;}(),geocodeAsync:function(){var _geocodeAsync=_asyncToGenerator(function*(){throw new GeocoderError();});function geocodeAsync(){return _geocodeAsync.apply(this,arguments);}return geocodeAsync;}(),reverseGeocodeAsync:function(){var _reverseGeocodeAsync=_asyncToGenerator(function*(){throw new GeocoderError();});function reverseGeocodeAsync(){return _reverseGeocodeAsync.apply(this,arguments);}return reverseGeocodeAsync;}(),watchPositionImplAsync:function(){var _watchPositionImplAsync=_asyncToGenerator(function*(watchId,options){return new Promise(function(resolve){watchId=global.navigator.geolocation.watchPosition(function(position){lastKnownPosition=geolocationPositionToJSON(position);LocationEventEmitter.emit('Expo.locationChanged',{watchId:watchId,location:lastKnownPosition});},undefined,options);resolve(watchId);});});function watchPositionImplAsync(_x4,_x5){return _watchPositionImplAsync.apply(this,arguments);}return watchPositionImplAsync;}(),getPermissionsAsync:getPermissionsAsync,requestPermissionsAsync:function(){var _requestPermissionsAsync=_asyncToGenerator(function*(){return getPermissionsAsync();});function requestPermissionsAsync(){return _requestPermissionsAsync.apply(this,arguments);}return requestPermissionsAsync;}(),requestForegroundPermissionsAsync:function(){var _requestForegroundPermissionsAsync=_asyncToGenerator(function*(){return getPermissionsAsync();});function requestForegroundPermissionsAsync(){return _requestForegroundPermissionsAsync.apply(this,arguments);}return requestForegroundPermissionsAsync;}(),requestBackgroundPermissionsAsync:function(){var _requestBackgroundPermissionsAsync=_asyncToGenerator(function*(){return getPermissionsAsync();});function requestBackgroundPermissionsAsync(){return _requestBackgroundPermissionsAsync.apply(this,arguments);}return requestBackgroundPermissionsAsync;}(),getForegroundPermissionsAsync:function(){var _getForegroundPermissionsAsync=_asyncToGenerator(function*(){return getPermissionsAsync();});function getForegroundPermissionsAsync(){return _getForegroundPermissionsAsync.apply(this,arguments);}return getForegroundPermissionsAsync;}(),getBackgroundPermissionsAsync:function(){var _getBackgroundPermissionsAsync=_asyncToGenerator(function*(){return getPermissionsAsync();});function getBackgroundPermissionsAsync(){return _getBackgroundPermissionsAsync.apply(this,arguments);}return getBackgroundPermissionsAsync;}(),startObserving:function startObserving(){},stopObserving:function stopObserving(){}};","map":{"version":3,"mappings":"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","names":["PermissionStatus","LocationAccuracy","LocationEventEmitter","GeocoderError","code","Error","geolocationPositionToJSON","position","coords","timestamp","latitude","longitude","altitude","accuracy","altitudeAccuracy","heading","speed","isLocationValid","location","options","maxAge","Infinity","requiredAccuracy","locationAccuracy","Date","now","getPermissionsAsync","Promise","resolve","resolveWithStatus","status","granted","GRANTED","canAskAgain","expires","navigator","geolocation","getCurrentPosition","DENIED","UNDETERMINED","enableHighAccuracy","maximumAge","lastKnownPosition","name","getProviderStatusAsync","locationServicesEnabled","getLastKnownPositionAsync","getCurrentPositionAsync","reject","resolver","Balanced","removeWatchAsync","watchId","clearWatch","watchDeviceHeading","headingId","console","warn","hasServicesEnabledAsync","geocodeAsync","reverseGeocodeAsync","watchPositionImplAsync","global","watchPosition","emit","undefined","requestPermissionsAsync","requestForegroundPermissionsAsync","requestBackgroundPermissionsAsync","getForegroundPermissionsAsync","getBackgroundPermissionsAsync","startObserving","stopObserving"],"sourceRoot":"","sources":["../src/ExpoLocation.web.ts"],"sourcesContent":["import { PermissionResponse, PermissionStatus } from 'expo-modules-core';\n\nimport {\n  LocationLastKnownOptions,\n  LocationObject,\n  LocationOptions,\n  LocationAccuracy,\n} from './Location.types';\nimport { LocationEventEmitter } from './LocationEventEmitter';\n\nclass GeocoderError extends Error {\n  code: string;\n\n  constructor() {\n    super('Geocoder service is not available for this device.');\n    this.code = 'E_NO_GEOCODER';\n  }\n}\n\n/**\n * Converts `GeolocationPosition` to JavaScript object.\n */\nfunction geolocationPositionToJSON(position: LocationObject): LocationObject {\n  const { coords, timestamp } = position;\n  return {\n    coords: {\n      latitude: coords.latitude,\n      longitude: coords.longitude,\n      altitude: coords.altitude,\n      accuracy: coords.accuracy,\n      altitudeAccuracy: coords.altitudeAccuracy,\n      heading: coords.heading,\n      speed: coords.speed,\n    },\n    timestamp,\n  };\n}\n\n/**\n * Checks whether given location didn't exceed given `maxAge` and fits in the required accuracy.\n */\nfunction isLocationValid(location: LocationObject, options: LocationLastKnownOptions): boolean {\n  const maxAge = typeof options.maxAge === 'number' ? options.maxAge : Infinity;\n  const requiredAccuracy =\n    typeof options.requiredAccuracy === 'number' ? options.requiredAccuracy : Infinity;\n  const locationAccuracy = location.coords.accuracy ?? Infinity;\n\n  return Date.now() - location.timestamp <= maxAge && locationAccuracy <= requiredAccuracy;\n}\n\n/**\n * Gets the permission details. The implementation is not very good as it actually requests\n * for the current location, but there is no better way on web so far :(\n */\nasync function getPermissionsAsync(): Promise<PermissionResponse> {\n  return new Promise<PermissionResponse>((resolve) => {\n    const resolveWithStatus = (status) =>\n      resolve({\n        status,\n        granted: status === PermissionStatus.GRANTED,\n        canAskAgain: true,\n        expires: 0,\n      });\n\n    navigator.geolocation.getCurrentPosition(\n      () => resolveWithStatus(PermissionStatus.GRANTED),\n      ({ code }) => {\n        if (code === 1 /* PERMISSION_DENIED */) {\n          resolveWithStatus(PermissionStatus.DENIED);\n        } else {\n          resolveWithStatus(PermissionStatus.UNDETERMINED);\n        }\n      },\n      { enableHighAccuracy: false, maximumAge: Infinity }\n    );\n  });\n}\n\nlet lastKnownPosition: LocationObject | null = null;\n\nexport default {\n  get name(): string {\n    return 'ExpoLocation';\n  },\n  async getProviderStatusAsync(): Promise<{ locationServicesEnabled: boolean }> {\n    return {\n      locationServicesEnabled: 'geolocation' in navigator,\n    };\n  },\n  async getLastKnownPositionAsync(\n    options: LocationLastKnownOptions = {}\n  ): Promise<LocationObject | null> {\n    if (lastKnownPosition && isLocationValid(lastKnownPosition, options)) {\n      return lastKnownPosition;\n    }\n    return null;\n  },\n  async getCurrentPositionAsync(options: LocationOptions): Promise<LocationObject> {\n    return new Promise<LocationObject>((resolve, reject) => {\n      const resolver = (position) => {\n        lastKnownPosition = geolocationPositionToJSON(position);\n        resolve(lastKnownPosition);\n      };\n      navigator.geolocation.getCurrentPosition(resolver, reject, {\n        maximumAge: Infinity,\n        enableHighAccuracy: (options.accuracy ?? 0) > LocationAccuracy.Balanced,\n        ...options,\n      });\n    });\n  },\n  async removeWatchAsync(watchId): Promise<void> {\n    navigator.geolocation.clearWatch(watchId);\n  },\n  async watchDeviceHeading(headingId): Promise<void> {\n    console.warn('Location.watchDeviceHeading: is not supported on web');\n  },\n  async hasServicesEnabledAsync(): Promise<boolean> {\n    return 'geolocation' in navigator;\n  },\n  async geocodeAsync(): Promise<any[]> {\n    throw new GeocoderError();\n  },\n  async reverseGeocodeAsync(): Promise<any[]> {\n    throw new GeocoderError();\n  },\n  async watchPositionImplAsync(watchId: string, options: LocationOptions): Promise<string> {\n    return new Promise<string>((resolve) => {\n      // @ts-ignore: the types here need to be fixed\n      watchId = global.navigator.geolocation.watchPosition(\n        (position) => {\n          lastKnownPosition = geolocationPositionToJSON(position);\n          LocationEventEmitter.emit('Expo.locationChanged', {\n            watchId,\n            location: lastKnownPosition,\n          });\n        },\n        undefined,\n        // @ts-ignore: the options object needs to be fixed\n        options\n      );\n      resolve(watchId);\n    });\n  },\n\n  getPermissionsAsync,\n  async requestPermissionsAsync(): Promise<PermissionResponse> {\n    return getPermissionsAsync();\n  },\n  async requestForegroundPermissionsAsync(): Promise<PermissionResponse> {\n    return getPermissionsAsync();\n  },\n  async requestBackgroundPermissionsAsync(): Promise<PermissionResponse> {\n    return getPermissionsAsync();\n  },\n  async getForegroundPermissionsAsync(): Promise<PermissionResponse> {\n    return getPermissionsAsync();\n  },\n  async getBackgroundPermissionsAsync(): Promise<PermissionResponse> {\n    return getPermissionsAsync();\n  },\n\n  // no-op\n  startObserving() {},\n  stopObserving() {},\n};\n"]},"metadata":{},"sourceType":"module"}