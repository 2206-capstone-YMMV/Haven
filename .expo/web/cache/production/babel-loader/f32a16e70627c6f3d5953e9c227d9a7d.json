{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{useEffect,useState}from'react';import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import View from\"react-native-web/dist/exports/View\";import TextInput from\"react-native-web/dist/exports/TextInput\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import Alert from\"react-native-web/dist/exports/Alert\";import{auth}from\"../firebase\";import{db}from\"../firebase\";import{collection,onSnapshot,query,where,addDoc}from'firebase/firestore';import{LinearGradient}from'expo-linear-gradient';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function MessagesTab(_ref){var navigation=_ref.navigation,route=_ref.route;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),people=_useState2[0],setPeople=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),search=_useState4[0],setSearch=_useState4[1];var filteredPeople=people.filter(function(user){return user.name.indexOf(search)>=0;});var conversations=route.params.conversations;var talking=[];conversations.forEach(function(convo){talking.push(convo.user);talking.push(convo.otherUser);});if(talking.length===0){talking.push(auth.currentUser.uid);}useEffect(function(){return onSnapshot(query(collection(db,'users'),where('uid','not-in',talking)),function(snapshot){return setPeople(snapshot.docs.map(function(user){return user.data();}));});},[]);var newConversation=function newConversation(person){addDoc(collection(db,'Conversations'),{user:auth.currentUser.uid,otherUser:person.uid,conversationId:auth.currentUser.uid+person.uid}).catch(function(error){return alert(error.message);});addDoc(collection(db,'Conversations'),{user:person.uid,otherUser:auth.currentUser.uid,conversationId:auth.currentUser.uid+person.uid}).then(navigation.navigate('Messages')).catch(function(error){return alert(error.message);});};var newConversationAlert=function newConversationAlert(person){Alert.alert(\"New Conversation\",\"Start a conversation with \"+person.name,[{text:\"Create\",onPress:function onPress(){return newConversation(person);}},{text:\"Cancel\",style:\"cancel\"}]);};return _jsxs(LinearGradient,{colors:[\"#8c5aa5\",\"#f2e797\"],style:{padding:5,flex:1,alignItems:'center'},children:[_jsx(Text,{style:styles.header,children:\"New Conversation\"}),_jsx(TextInput,{style:styles.textInput,value:search,placeholder:\"Search By Name\",underlineColorAndroid:\"transparent\",onChangeText:function onChangeText(text){return setSearch(text);}}),_jsx(ScrollView,{contentContainerStyle:styles.list,children:filteredPeople.map(function(person,index){if(person.role==='helper'){return _jsx(Text,{style:[styles.person,styles.helper],onPress:function onPress(){return newConversation(person);},children:person.name},index);}else{return _jsx(Text,{style:styles.person,onPress:function onPress(){return newConversationAlert(person);},children:person.name},index);}})})]});}var styles=StyleSheet.create({header:{fontSize:'50%'},list:{flexDirection:\"row\",flexWrap:\"wrap\",justifyContent:\"center\"},person:{backgroundColor:'white',padding:20,margin:10,borderRadius:10,borderColor:\"navy\",borderWidth:5,overflow:\"hidden\",fontSize:20},helper:{borderColor:\"black\"},textInput:{width:'70%',borderWidth:1,paddingLeft:20,margin:5,fontSize:16,paddingVertical:8,marginBottom:30,borderColor:'#009688',backgroundColor:'white'}});","map":{"version":3,"names":["React","useEffect","useState","auth","db","collection","onSnapshot","query","where","addDoc","LinearGradient","MessagesTab","navigation","route","people","setPeople","search","setSearch","filteredPeople","filter","user","name","indexOf","conversations","params","talking","forEach","convo","push","otherUser","length","currentUser","uid","snapshot","docs","map","data","newConversation","person","conversationId","catch","error","alert","message","then","navigate","newConversationAlert","Alert","text","onPress","style","padding","flex","alignItems","styles","header","textInput","list","index","role","helper","StyleSheet","create","fontSize","flexDirection","flexWrap","justifyContent","backgroundColor","margin","borderRadius","borderColor","borderWidth","overflow","width","paddingLeft","paddingVertical","marginBottom"],"sources":["C:/Users/16476/Documents/GitHub/Haven/screens/StartConversation.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { StyleSheet, Text, View, TextInput, ScrollView, Alert } from \"react-native\";\r\nimport { auth } from '../firebase'\r\nimport { db } from '../firebase'\r\nimport { collection, onSnapshot, query, where, addDoc } from 'firebase/firestore' \r\nimport { LinearGradient } from 'expo-linear-gradient';\r\n\r\nexport default function MessagesTab({ navigation, route }) {\r\n    \r\n    const [people, setPeople] = useState([])\r\n    const [search, setSearch] = useState('')\r\n\r\n    const filteredPeople = people.filter((user) => {\r\n        return user.name.indexOf(search) >= 0\r\n    })\r\n\r\n    let { conversations } = route.params\r\n            let talking = []\r\n            conversations.forEach(convo => { //Making an array with all users this user is talking to\r\n                talking.push(convo.user)\r\n                talking.push(convo.otherUser)\r\n            })\r\n            if (talking.length === 0){ //if no conversations have been started only exclude the current user. not-in needs none empty array\r\n                talking.push(auth.currentUser.uid)\r\n            }\r\n        \r\n\r\n    useEffect(\r\n        () => \r\n            onSnapshot(query(collection(db, 'users'), where('uid', 'not-in', talking)), (snapshot) =>\r\n            setPeople(snapshot.docs.map(user => {\r\n                return user.data()\r\n            }))),\r\n          [])\r\n\r\n    const newConversation = (person) => {\r\n        addDoc(collection(db, 'Conversations'),{user: auth.currentUser.uid, otherUser: person.uid, conversationId: auth.currentUser.uid + person.uid})\r\n        .catch(error => alert(error.message))\r\n        addDoc(collection(db, 'Conversations'),{user: person.uid, otherUser: auth.currentUser.uid, conversationId: auth.currentUser.uid + person.uid})\r\n        .then(navigation.navigate('Messages'))\r\n        .catch(error => alert(error.message))\r\n    }\r\n\r\n    const newConversationAlert = (person) => {\r\n        Alert.alert(\r\n          `New Conversation`,\r\n          `Start a conversation with ${person.name}`,\r\n          [\r\n            {\r\n              text: \"Create\",\r\n              onPress: () => newConversation(person)\r\n            },\r\n            {\r\n              text: \"Cancel\",\r\n              style: \"cancel\"\r\n            }\r\n          ]\r\n        )\r\n      }\r\n    \r\n    return (\r\n        <LinearGradient colors={[\"#8c5aa5\", \"#f2e797\"]} style={{padding: 5, flex: 1, alignItems: 'center'}}>\r\n            <Text style={styles.header}>New Conversation</Text>\r\n            <TextInput \r\n                style={styles.textInput}\r\n                value={search}\r\n                placeholder='Search By Name'\r\n                underlineColorAndroid='transparent'\r\n                onChangeText={(text) => setSearch(text)}\r\n            />\r\n            <ScrollView contentContainerStyle={styles.list}>\r\n                {filteredPeople.map((person,index) => {\r\n                if (person.role === 'helper'){\r\n                    return <Text key={index} style={[styles.person, styles.helper]} onPress={() => newConversation(person)}>{person.name}</Text>\r\n                }\r\n                else{\r\n                    return <Text key={index} style={styles.person} onPress={() => newConversationAlert(person)}>{person.name}</Text>\r\n                }})}\r\n            </ScrollView>\r\n        </LinearGradient>\r\n    )\r\n}\r\n\r\n\r\nconst styles = StyleSheet.create({\r\n    header: {\r\n        fontSize: '50%'\r\n    },\r\n    list: {\r\n        flexDirection: \"row\",\r\n        flexWrap: \"wrap\",\r\n        justifyContent: \"center\"\r\n    },\r\n    person: {\r\n        backgroundColor: 'white',\r\n        padding: 20,\r\n        margin: 10,\r\n        borderRadius: 10,\r\n        borderColor: \"navy\",\r\n        borderWidth: 5,\r\n        overflow: \"hidden\",\r\n        fontSize: 20,\r\n    },\r\n    helper: {\r\n        borderColor: \"black\"\r\n    },\r\n    textInput: {\r\n        width: '70%',\r\n        borderWidth: 1,\r\n        paddingLeft: 20,\r\n        margin: 5,\r\n        fontSize: 16,\r\n        paddingVertical: 8,\r\n        marginBottom: 30,\r\n        borderColor: '#009688',\r\n        backgroundColor: 'white',\r\n      },\r\n})"],"mappings":"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"},"metadata":{},"sourceType":"module"}