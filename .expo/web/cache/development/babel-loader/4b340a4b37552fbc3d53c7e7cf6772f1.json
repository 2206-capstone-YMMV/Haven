{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useEffect, useState } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport { auth } from \"../firebase\";\nimport { db } from \"../firebase\";\nimport { collection, onSnapshot, query, where, getDocs } from \"firebase/firestore\";\nimport { LinearGradient } from \"expo-linear-gradient\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function MessagesTab(_ref) {\n  var navigation = _ref.navigation;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      conversations = _useState2[0],\n      setConversations = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      otherUsers = _useState4[0],\n      setOtherUsers = _useState4[1];\n\n  useEffect(function () {\n    var _auth$currentUser;\n\n    return onSnapshot(query(collection(db, \"Conversations\"), where(\"user\", \"==\", (_auth$currentUser = auth.currentUser) == null ? void 0 : _auth$currentUser.uid)), function (snapshot) {\n      return setConversations(snapshot.docs.map(function (convo) {\n        console.log(\"Grabbing Convos\");\n        return convo.data();\n      }));\n    });\n  }, []);\n  var conversationIds = conversations.map(function (convo) {\n    return convo.conversationId;\n  });\n  var otherUsersId = conversations.map(function (convo) {\n    if (convo.user === auth.currentUser.uid) {\n      return convo.otherUser;\n    } else {\n      return convo.user;\n    }\n\n    convo.otherUser;\n  });\n\n  if (otherUsersId.length === 0) {\n    otherUsersId.push(\"aaaaaaaaaaa\");\n  }\n\n  if (conversations.length > 0 && otherUsers.length === 0 || conversations.length > otherUsers.length) {\n    getDocs(query(collection(db, \"users\"), where(\"uid\", \"in\", otherUsersId))).then(function (users) {\n      return setOtherUsers(users.docs.map(function (user) {\n        console.log(\"Grabbing aquaintances\");\n        return user.data();\n      }));\n    });\n  }\n\n  var names = otherUsersId.map(function (id) {\n    for (var i = 0; i < otherUsers.length; i++) {\n      if (otherUsers[i].uid === id) {\n        return otherUsers[i].name;\n      }\n    }\n  });\n  return _jsxs(LinearGradient, {\n    colors: [\"#8c5aa5\", \"#f2e797\"],\n    style: {\n      flex: 1,\n      alignItems: \"center\",\n      justifyContent: \"space-between\"\n    },\n    children: [_jsx(Text, {\n      style: [styles.convo, styles.new],\n      onPress: function onPress() {\n        return navigation.navigate(\"NewConversation\", {\n          conversations: conversations\n        });\n      },\n      children: \"New Conversation\"\n    }), _jsx(ScrollView, {\n      children: conversationIds.map(function (conversationId, index) {\n        return _jsxs(Text, {\n          style: styles.convo,\n          onPress: function onPress() {\n            return navigation.navigate(\"Message\", {\n              conversationId: conversationId\n            });\n          },\n          children: [\"Conversation with \", names[index]]\n        }, index);\n      })\n    })]\n  });\n}\nvar styles = StyleSheet.create({\n  new: {\n    marginBottom: \"10%\",\n    fontSize: 30\n  },\n  convo: {\n    backgroundColor: \"white\",\n    paddingVertical: 5,\n    paddingHorizontal: 5,\n    marginTop: 5,\n    borderRadius: 10,\n    overflow: \"hidden\",\n    textAlign: \"center\",\n    fontSize: 18\n  }\n});","map":{"version":3,"names":["React","useEffect","useState","auth","db","collection","onSnapshot","query","where","getDocs","LinearGradient","MessagesTab","navigation","conversations","setConversations","otherUsers","setOtherUsers","currentUser","uid","snapshot","docs","map","convo","console","log","data","conversationIds","conversationId","otherUsersId","user","otherUser","length","push","then","users","names","id","i","name","flex","alignItems","justifyContent","styles","new","navigate","index","StyleSheet","create","marginBottom","fontSize","backgroundColor","paddingVertical","paddingHorizontal","marginTop","borderRadius","overflow","textAlign"],"sources":["C:/Users/16476/Documents/GitHub/Haven/screens/MessagesTab.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { StyleSheet, Text, View, ScrollView } from \"react-native\";\r\nimport { auth } from \"../firebase\";\r\nimport { db } from \"../firebase\";\r\nimport {\r\n  collection,\r\n  onSnapshot,\r\n  query,\r\n  where,\r\n  getDocs,\r\n} from \"firebase/firestore\";\r\nimport { LinearGradient } from \"expo-linear-gradient\";\r\n\r\nexport default function MessagesTab({ navigation }) {\r\n  const [conversations, setConversations] = useState([]);\r\n  const [otherUsers, setOtherUsers] = useState([]);\r\n\r\n  useEffect(\r\n    () =>\r\n      onSnapshot(\r\n        query(\r\n          collection(db, \"Conversations\"),\r\n          where(\"user\", \"==\", auth.currentUser?.uid)\r\n        ),\r\n        (snapshot) =>\r\n          setConversations(\r\n            snapshot.docs.map((convo) => {\r\n              console.log(\"Grabbing Convos\")\r\n              return convo.data();\r\n            })\r\n          )\r\n      ),\r\n    []\r\n  );\r\n\r\n  const conversationIds = conversations.map((convo) => convo.conversationId);\r\n  const otherUsersId = conversations.map((convo) => {\r\n    if (convo.user === auth.currentUser.uid){\r\n      return convo.otherUser\r\n    }\r\n    else{\r\n      return convo.user\r\n    }\r\n    convo.otherUser});\r\n\r\n  if (otherUsersId.length === 0) {\r\n    otherUsersId.push(\"aaaaaaaaaaa\");\r\n  }\r\n\r\n  if (\r\n    (conversations.length > 0 && otherUsers.length === 0) ||\r\n    conversations.length > otherUsers.length\r\n  ) {\r\n    //After the conversations have been grabbed, but dont want this to repeat when page rerenders\r\n    getDocs(\r\n      query(collection(db, \"users\"), where(\"uid\", \"in\", otherUsersId))\r\n    ).then((users) =>\r\n      setOtherUsers(\r\n        users.docs.map((user) => {\r\n          console.log(\"Grabbing aquaintances\")\r\n          return user.data();\r\n        })\r\n      )\r\n    );\r\n  }\r\n\r\n  const names = otherUsersId.map((id) => {\r\n    //lining up names with the order of the conversationIds\r\n    for (let i = 0; i < otherUsers.length; i++) {\r\n      if (otherUsers[i].uid === id) {\r\n        return otherUsers[i].name;\r\n      }\r\n    }\r\n  });\r\n\r\n  // console.log(names)\r\n\r\n  return (\r\n    <LinearGradient\r\n      colors={[\"#8c5aa5\", \"#f2e797\"]}\r\n      style={{ flex: 1, alignItems: \"center\", justifyContent: \"space-between\" }}\r\n    >\r\n      <Text\r\n        style={[styles.convo, styles.new]}\r\n        onPress={() =>\r\n          navigation.navigate(\"NewConversation\", { conversations })\r\n        }\r\n      >\r\n        New Conversation\r\n      </Text>\r\n      <ScrollView>\r\n        {conversationIds.map((conversationId, index) => (\r\n          <Text\r\n            key={index}\r\n            style={styles.convo}\r\n            onPress={() => navigation.navigate(\"Message\", { conversationId })}\r\n          >\r\n            Conversation with {names[index]}\r\n          </Text>\r\n        ))}\r\n      </ScrollView>\r\n    </LinearGradient>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  new: {\r\n    marginBottom: \"10%\",\r\n    fontSize: 30,\r\n  },\r\n  convo: {\r\n    backgroundColor: \"white\",\r\n    paddingVertical: 5,\r\n    paddingHorizontal: 5,\r\n    marginTop: 5,\r\n    borderRadius: 10,\r\n    overflow: \"hidden\",\r\n    textAlign: \"center\",\r\n    fontSize: 18,\r\n  },\r\n});\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}